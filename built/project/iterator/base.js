define(["subject","lodash"],function(e,t){var n=e(function(t,n){this.data=t,n=n||{},this.currentIndex=n.startAt||-1,this.options=n,this.evaluate=n.evaluate||n.evaluator||this.evaluate});n.proto({move:function(t){return this.index(this.currentIndex+t),this},evaluate:function(t){return t},evaluator:function(t){return this.evaluate=t,this},start:function(){return this.currentIndex=-1,this},end:function(){return this.currentIndex=this.length(),this},index:function(t){if(t>this.length()-1||t<0)throw new Error("No such index "+t);return this.currentIndex=t,this},countBefore:function(){return this.currentIndex+1},countAfter:function(){return this.length()-(this.currentIndex+1)},range:function(t,n){var r=[];while(t<=n)r.push(this.at(t)),t++;return r},hasNext:function(){return this.currentIndex<this.length()-1},next:function(){return this.move(1),this.current()},nextN:function(t){var n=[],r=this.currentIndex+t-1;while(this.hasNext()&&this.currentIndex<=r)n.push(this.next());return n},hasPrevious:function(){return this.currentIndex>0},previous:function(){return this.move(-1),this.current()},previousN:function(t){var n=[],r=this.currentIndex-t+1;while(this.hasPrevious()&&this.currentIndex>=r)n.push(this.previous());return n},current:function(){return this.at(this.currentIndex)},value:function(){return this.data}}),n.proto({hasPrev:n.prototype.hasPrevious,prev:n.prototype.previous,prevN:n.prototype.previousN});var r=["map","filter","compact","difference"];return t.each(r,function(e){n.proto(e,function(){var n=t(this.data);n=n[e].apply(n,arguments);var r=this.constructor(n.value());return r})}),n});